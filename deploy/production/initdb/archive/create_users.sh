#!/usr/bin/env bash

psql=( psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" )

file_env 'ARCHIVE_READ_USER'
file_env 'ARCHIVE_READ_USER_PASSWORD'

file_env 'ARCHIVE_WRITE_USER'
file_env 'ARCHIVE_WRITE_USER_PASSWORD'

"${psql[@]}" <<-EOSQL
	CREATE USER "$ARCHIVE_READ_USER" WITH PASSWORD '$ARCHIVE_READ_USER_PASSWORD';
	GRANT SELECT ON ALL TABLES IN SCHEMA public TO "$ARCHIVE_READ_USER";
	CREATE USER "$ARCHIVE_WRITE_USER" WITH PASSWORD '$ARCHIVE_WRITE_USER_PASSWORD';
	GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA public TO "$ARCHIVE_WRITE_USER";
	GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO "$ARCHIVE_WRITE_USER";
EOSQL
